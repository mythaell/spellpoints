{"name":"Spell Points, Lvl6","permission":{"default":0,"RgsXrHLXav2GTdOO":3},"type":"script","flags":{"combat-utility-belt":{"macroTrigger":"kl1obvk4xdgffvi6"},"furnace":{"runAsGM":true}},"scope":"global","command":"let s_actor = game.user.character;\r\n\r\nlet s_cost = 9;\r\n\r\nlet actorUpdateData = duplicate(s_actor);\r\n\r\nactorUpdateData.data.spells.spell6.value += 1;\r\n\r\nactorUpdateData.data.resources.primary.value -= s_cost;\r\n\r\ns_actor.update(actorUpdateData);\r\n\r\nlet feedback = s_cost+ \" Spell Points Consumed\\n \"+ actorUpdateData.data.resources.primary.value +\" Spell Points remaining\"\r\n\r\nChatMessage.create({\r\n\r\nuser : game.user._id,\r\n\r\ncontent : feedback,\r\n\r\nspeaker : speaker\r\n\r\n});","author":"RgsXrHLXav2GTdOO","img":"icons/svg/dice-target.svg","actorIds":[],"_id":"5kKrwaVSlG5wz5xg"}
{"name":"Spell Points, Lvl5","permission":{"default":0,"RgsXrHLXav2GTdOO":3},"type":"script","flags":{"combat-utility-belt":{"macroTrigger":"swg0vqu2yyroxsrd"},"furnace":{"runAsGM":true}},"scope":"global","command":"let s_actor = game.user.character;\r\n\r\nlet s_cost = 7;\r\n\r\nlet actorUpdateData = duplicate(s_actor);\r\n\r\nactorUpdateData.data.spells.spell5.value += 1;\r\n\r\nactorUpdateData.data.resources.primary.value -= s_cost;\r\n\r\ns_actor.update(actorUpdateData);\r\n\r\nlet feedback = s_cost+ \" Spell Points Consumed\\n \"+ actorUpdateData.data.resources.primary.value +\" Spell Points remaining\"\r\n\r\nChatMessage.create({\r\n\r\nuser : game.user._id,\r\n\r\ncontent : feedback,\r\n\r\nspeaker : speaker\r\n\r\n});","author":"RgsXrHLXav2GTdOO","img":"icons/svg/dice-target.svg","actorIds":[],"_id":"LRf0GotrjgaHbm5t"}
{"name":"Spell Points, Lvl4","permission":{"default":0,"RgsXrHLXav2GTdOO":3},"type":"script","flags":{"combat-utility-belt":{"macroTrigger":"eindpnkvd7li8niw"},"furnace":{"runAsGM":true}},"scope":"global","command":"let s_actor = game.user.character;\r\n\r\nlet s_cost = 6;\r\n\r\nlet actorUpdateData = duplicate(s_actor);\r\n\r\nactorUpdateData.data.spells.spell4.value += 1;\r\n\r\nactorUpdateData.data.resources.primary.value -= s_cost;\r\n\r\ns_actor.update(actorUpdateData);\r\n\r\nlet feedback = s_cost+ \" Spell Points Consumed\\n \"+ actorUpdateData.data.resources.primary.value +\" Spell Points remaining\"\r\n\r\nChatMessage.create({\r\n\r\nuser : game.user._id,\r\n\r\ncontent : feedback,\r\n\r\nspeaker : speaker\r\n\r\n});","author":"RgsXrHLXav2GTdOO","img":"icons/svg/dice-target.svg","actorIds":[],"_id":"QMaLJYKeURcGbcDq"}
{"name":"Spell Points, Lvl2","permission":{"default":0,"RgsXrHLXav2GTdOO":3},"type":"script","flags":{"combat-utility-belt":{"macroTrigger":"g9b8dq32rmohx9fc"},"furnace":{"runAsGM":true}},"scope":"global","command":"let s_actor = game.user.character;\r\n\r\nlet s_cost = 3;\r\n\r\nlet actorUpdateData = duplicate(s_actor);\r\n\r\nactorUpdateData.data.spells.spell2.value += 1;\r\n\r\nactorUpdateData.data.resources.primary.value -= s_cost;\r\n\r\ns_actor.update(actorUpdateData);\r\n\r\nlet feedback = s_cost+ \" Spell Points Consumed\\n \"+ actorUpdateData.data.resources.primary.value +\" Spell Points remaining\"\r\n\r\nChatMessage.create({\r\n\r\nuser : game.user._id,\r\n\r\ncontent : feedback,\r\n\r\nspeaker : speaker\r\n\r\n});","author":"RgsXrHLXav2GTdOO","img":"icons/svg/dice-target.svg","actorIds":[],"_id":"fX1uoAGUNnzjOjYG"}
{"name":"Spell Points, Lvl3","permission":{"default":0,"RgsXrHLXav2GTdOO":3},"type":"script","flags":{"combat-utility-belt":{"macroTrigger":"gbk7y79nm4jnko8v"},"furnace":{"runAsGM":true}},"scope":"global","command":"let s_actor = game.user.character;\r\n\r\nlet s_cost = 5;\r\n\r\nlet actorUpdateData = duplicate(s_actor);\r\n\r\nactorUpdateData.data.spells.spell3.value += 1;\r\n\r\nactorUpdateData.data.resources.primary.value -= s_cost;\r\n\r\ns_actor.update(actorUpdateData);\r\n\r\nlet feedback = s_cost+ \" Spell Points Consumed\\n \"+ actorUpdateData.data.resources.primary.value +\" Spell Points remaining\"\r\n\r\nChatMessage.create({\r\n\r\nuser : game.user._id,\r\n\r\ncontent : feedback,\r\n\r\nspeaker : speaker\r\n\r\n});","author":"RgsXrHLXav2GTdOO","img":"icons/svg/dice-target.svg","actorIds":[],"_id":"ik1RvVL37myI7Xzy"}
{"name":"Spell Points, Lvl9","permission":{"default":0,"RgsXrHLXav2GTdOO":3},"type":"script","flags":{"combat-utility-belt":{"macroTrigger":"0bqth406lqdk7le0"},"furnace":{"runAsGM":true}},"scope":"global","command":"let s_actor = game.user.character;\r\n\r\nlet s_cost = 13;\r\n\r\nlet actorUpdateData = duplicate(s_actor);\r\n\r\nactorUpdateData.data.spells.spell9.value += 1;\r\n\r\nactorUpdateData.data.resources.primary.value -= s_cost;\r\n\r\ns_actor.update(actorUpdateData);\r\n\r\nlet feedback = s_cost+ \" Spell Points Consumed\\n \"+ actorUpdateData.data.resources.primary.value +\" Spell Points remaining\"\r\n\r\nChatMessage.create({\r\n\r\nuser : game.user._id,\r\n\r\ncontent : feedback,\r\n\r\nspeaker : speaker\r\n\r\n});","author":"RgsXrHLXav2GTdOO","img":"icons/svg/dice-target.svg","actorIds":[],"_id":"jb5Xm7jnlfcf7ypa"}
{"name":"Spell Points, Lvl7","permission":{"default":0,"RgsXrHLXav2GTdOO":3},"type":"script","flags":{"combat-utility-belt":{"macroTrigger":"w046aw9v21ltq3xh"},"furnace":{"runAsGM":true}},"scope":"global","command":"let s_actor = game.user.character;\r\n\r\nlet s_cost = 10;\r\n\r\nlet actorUpdateData = duplicate(s_actor);\r\n\r\nactorUpdateData.data.spells.spell7.value += 1;\r\n\r\nactorUpdateData.data.resources.primary.value -= s_cost;\r\n\r\ns_actor.update(actorUpdateData);\r\n\r\nlet feedback = s_cost+ \" Spell Points Consumed\\n \"+ actorUpdateData.data.resources.primary.value +\" Spell Points remaining\"\r\n\r\nChatMessage.create({\r\n\r\nuser : game.user._id,\r\n\r\ncontent : feedback,\r\n\r\nspeaker : speaker\r\n\r\n});","author":"RgsXrHLXav2GTdOO","img":"icons/svg/dice-target.svg","actorIds":[],"_id":"oFWwKl19msUtdZyK"}
{"name":"Spell Points, Lvl1","permission":{"default":0,"RgsXrHLXav2GTdOO":3},"type":"script","flags":{"combat-utility-belt":{"macroTrigger":"tju8s0qa4cosiz9u"},"furnace":{"runAsGM":true}},"scope":"global","command":"let s_actor = game.user.character;\r\n\r\nlet s_cost = 2;\r\n\r\nlet actorUpdateData = duplicate(s_actor);\r\n\r\nactorUpdateData.data.spells.spell1.value += 1;\r\n\r\nactorUpdateData.data.resources.primary.value -= s_cost;\r\n\r\ns_actor.update(actorUpdateData);\r\n\r\nlet feedback = s_cost+ \" Spell Points Consumed\\n \"+ actorUpdateData.data.resources.primary.value +\" Spell Points remaining\"\r\n\r\nChatMessage.create({\r\n\r\nuser : game.user._id,\r\n\r\ncontent : feedback,\r\n\r\nspeaker : speaker\r\n\r\n});","author":"RgsXrHLXav2GTdOO","img":"icons/svg/dice-target.svg","actorIds":[],"_id":"td8AcT9wdhHbxLXi"}
{"name":"Spell Points, Lvl8","permission":{"default":0,"RgsXrHLXav2GTdOO":3},"type":"script","flags":{"combat-utility-belt":{"macroTrigger":"qugc7cfylwh7kmv6"},"furnace":{"runAsGM":true}},"scope":"global","command":"let s_actor = game.user.character;\r\n\r\nlet s_cost = 11;\r\n\r\nlet actorUpdateData = duplicate(s_actor);\r\n\r\nactorUpdateData.data.spells.spell8.value += 1;\r\n\r\nactorUpdateData.data.resources.primary.value -= s_cost;\r\n\r\ns_actor.update(actorUpdateData);\r\n\r\nlet feedback = s_cost+ \" Spell Points Consumed\\n \"+ actorUpdateData.data.resources.primary.value +\" Spell Points remaining\"\r\n\r\nChatMessage.create({\r\n\r\nuser : game.user._id,\r\n\r\ncontent : feedback,\r\n\r\nspeaker : speaker\r\n\r\n});","author":"RgsXrHLXav2GTdOO","img":"icons/svg/dice-target.svg","actorIds":[],"_id":"uwU3zOEPMQmWk9pj"}
{"name":"Quest Log","permission":{"default":0,"jcut2oaI8fWHdG2n":3},"type":"script","flags":{"combat-utility-belt":{"macroTrigger":""},"furnace":{"runAsGM":false}},"scope":"global","command":"if (QuestLog.rendered)\r\n  QuestLog.close();\r\nelse \r\n  QuestLog.render(true);","author":"jcut2oaI8fWHdG2n","img":"systems/dnd5e/icons/items/inventory/book.jpg","actorIds":[],"_id":"dFY28f1EorlVOl9R"}
{"name":"Equip Unequip Effects","permission":{"default":0,"jcut2oaI8fWHdG2n":3},"type":"script","flags":{"combat-utility-belt":{"macroTrigger":""}},"scope":"global","command":"const option1 = 'Blessed';\r\nconst option2 = 'Bladesong';\r\nconst option3 = 'Hasted';\r\n\r\nconst path1 = 'modules/plutonium/media/icon/spell/phb-bless.jpg';\r\nconst path2 = 'systems/dnd5e/icons/spells/wind-grasp-sky-2.jpg';\r\nconst path3 = 'modules/plutonium/media/icon/spell/phb-haste.jpg';\r\n\r\nconst queryTitle = \"Effect\"\r\nconst queryText = \"Choose effect to equip/unequip\"\r\nconst queryOptions = [option1, option2, option3]\r\n\r\nlet options = '';\r\nfor (let option of queryOptions) {\r\n  options += `<option value=\"${option}\">${option}</option>`\r\n}\r\n\r\nlet template = `\r\n<div>\r\n  <div class=\"form-group\">\r\n    <label>${queryText}</label>\r\n    <select id=\"selectedOption\">\r\n      ${options}\r\n    </select>\r\n  </div>\r\n</div>\r\n`\r\n\r\nnew Dialog({\r\n  title: queryTitle,\r\n  content: template,\r\n  buttons: {\r\n    ok: {\r\n      icon: '<i class=\"fas fa-check\"></i>',\r\n      label: \"OK\",\r\n      callback: myCallback, \r\n    },\r\n    cancel: {\r\n      icon: '<i class=\"fas fa-times\"></i>',\r\n      label: 'Cancel',\r\n      callback: async (html) => {\r\n        console.log(\"canceled\");\r\n      }\r\n    }\r\n  },\r\n  default: \"cancel\"\r\n}).render(true)\r\n\r\nfunction chatMessage(messageContent) {\r\n\t// create the message\r\n\tif (messageContent !== '') {\r\n\t\tlet chatData = {\r\n\t\t\tuser: game.user._id,\r\n\t\t\tspeaker: ChatMessage.getSpeaker(),\r\n\t\t\tcontent: messageContent,\r\n\t\t};\r\n\t\tChatMessage.create(chatData, {});\r\n\t}\r\n}\r\n\r\nfunction myCallback(html) {\r\n  const selectedOption = html.find(\"#selectedOption\")[0].value;\r\n  console.log(\"selected option\", selectedOption);\r\n  \r\n  let itemName = html.find(\"#selectedOption\")[0].value; // <--- Change this to the *exact* item name (capitals count!)\r\n  let sendToChat = true; // <--- Change to 'true' or 'false' to display a chat message about equipping\r\n  let displayIcon = true; // <--- Change to 'true' or 'false' to display an effect icon when equipped\r\n  const effectIconPath = 'modules/plutonium/media/icon/spell/phb-bless.jpg';\r\n  \r\n  let toggleResult = false;\r\n\r\n  if (!actor) {\r\n    ui.notifications.warn('You need to select a token before using this macro!');\r\n  } else {\r\n    let myItem = actor.items.find(i => i.name == itemName);\r\n    if (myItem != null)\t{\r\n      let item = actor.getOwnedItem(myItem._id);\r\n      let attr = \"data.equipped\";\r\n      let equipped = getProperty(item.data, attr);\r\n      if (sendToChat) {\t\t\t\r\n        if (!equipped) {\r\n          chatMessage(actor.name + ' equipped the ' + itemName+ ' effect</i>');\r\n        } else {\r\n          chatMessage(actor.name + ' unequipped the ' + itemName + 'effect</i>');\t\t\t\r\n        }\r\n      }\r\n      item.update({[attr]: !getProperty(item.data, attr)});\r\n\r\n      (async () => {\r\n        if (displayIcon) {\r\n          if (itemName === option1) {\r\n            const effectIconPath = path1;\r\n            toggleResult = await token.toggleEffect(effectIconPath);\r\n            if (toggleResult == equipped) token.toggleEffect(effectIconPath);\r\n          } else if (itemName === option2) {\r\n            const effectIconPath = path2;\r\n            toggleResult = await token.toggleEffect(effectIconPath);\r\n            if (toggleResult == equipped) token.toggleEffect(effectIconPath);\r\n          } else if (itemName === option3) {\r\n            const effectIconPath = path3;\r\n            toggleResult = await token.toggleEffect(effectIconPath);\r\n            if (toggleResult == equipped) token.toggleEffect(effectIconPath);\r\n          } \t\r\n        }\r\n      })();  \r\n\r\n    } else {\r\n      ui.notifications.warn(\"No item named '\" + itemName + \"' found on character!\");\r\n    }\r\n  }\r\n}","author":"jcut2oaI8fWHdG2n","img":"modules/plutonium/media/icon/spell/phb-bless.jpg","actorIds":[],"_id":"tydJiLK1WWEjRaUw"}
{"name":"Shrink Or Enlarge","permission":{"default":0,"jcut2oaI8fWHdG2n":3},"type":"script","flags":{"combat-utility-belt":{"macroTrigger":""}},"scope":"global","command":"// Update selected tokens to flip between a 1x1 or a 2x2 grid.\r\n\r\nconst updates = [];\r\nfor (let token of canvas.tokens.controlled) {\r\n  let newSize = (token.data.height == 1 && token.data.width == 1) ? 2 : 1;\r\n  updates.push({\r\n    _id: token.id,\r\n    height: newSize,\r\n    width: newSize\r\n  });\r\n};\r\n\r\n// use `canvas.tokens.updateMany` instead of `token.update` to prevent race conditions\r\n// (meaning not all updates will be persisted and might only show locally)\r\ncanvas.tokens.updateMany(updates);\r\n","author":"jcut2oaI8fWHdG2n","img":"systems/dnd5e/icons/spells/wind-grasp-sky-1.jpg","actorIds":[],"_id":"BludzvNQUW02I5tt"}
{"name":"HAMDR","permission":{"default":0,"jcut2oaI8fWHdG2n":3},"type":"script","flags":{"combat-utility-belt":{"macroTrigger":""},"furnace":{"runAsGM":false}},"scope":"global","command":"//Crude but effective way to simulate Heavy Armor Master.\r\n//Every time the player takes eligible damage, they can just click this macro with their token selected to \"get their 3HP back.\"\r\n//Questions? Ask in #macro-polo on Discord. If absolutely needed, please ping Norc#5108.\r\n\r\n//Known minor limitation: Does not take into account temp HP AT ALL.\r\n\r\nfunction modifyHP(token, amount) {\r\n    let hp_cur = token.actor.data.data.attributes.hp.value;\r\n    let hp_max = token.actor.data.data.attributes.hp.max;\r\n    let hp_min = token.actor.data.data.attributes.hp.min;\r\n    hp_cur = (hp_cur+amount > hp_max) ? hp_max : hp_cur+amount;\r\n    hp_cur = (hp_cur < hp_min) ? hp_min : hp_cur;\r\n    token.actor.update({'data.attributes.hp.value': parseInt(hp_cur)});\r\n    return hp_cur;\r\n  }\r\n\r\nlet message = \"Adding 3 HP for Armor DR\";\r\n\r\nif(token) {\r\n    //Note: Just change the number after the comma to heal/receive other HP values. Negative numbers indicate damage.\r\n    modifyHP(token,3);\r\n    let chatData = {\r\n      user: game.user._id,\r\n      speaker: ChatMessage.getSpeaker(),\r\n      content: message,\r\n    };\r\n    ChatMessage.create(chatData,{});\r\n} else {\r\n    ui.notifications.notify(\"Please select a token.\");\r\n}\r\n","author":"jcut2oaI8fWHdG2n","img":"systems/dnd5e/icons/items/armor/spiked.png","actorIds":[],"_id":"XAz2mRAJpKHDTS8O"}
